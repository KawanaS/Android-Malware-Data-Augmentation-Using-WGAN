# -*- coding: utf-8 -*-
"""
Created on Sun May 15 16:57:28 2022

@author: Kawana S
"""
import sys
import os
import math
import numpy as np
from PIL import Image
from PIL import ImageMath
import cv2
from androguard.core.bytecodes.apk import APK

directory = "E:/Python/Machine_Learning/Android_source_code_analysis/Malware/SMS_malware2017/Zsone"

def get_dex_bytes(apk:APK) -> bytes:
    for f in apk.get_files():
        if f.endswith(".dex"):
            yield apk.get_file(f)
            
size=(128,128)

def generate_png():
    count = 0
    for file in os.listdir(directory):  
        a = APK(file)
        #a = apk.get_file(file)
        for s in get_dex_bytes(a):
            stream = bytes()
            stream += s
        current_len = len(stream)     
        image = Image.frombytes(mode='L', size=(1, current_len), data=stream)
        image = Image.frombytes(mode='L', size= (2,44253), data=stream)
        image = image.resize(size, Image.LANCZOS)
        image.save(f"E:/Python/Machine_Learning/Android_source_code_analysis/Malware/SMS_malware2017/Zsone/{file}.png")
             
generate_png()
